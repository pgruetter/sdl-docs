<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<title data-react-helmet="true">Execution Modes | Smart Data Lake Builder</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Execution Modes | Smart Data Lake Builder"><meta data-react-helmet="true" name="description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:url" content="https://pgruetter.github.io/sdl-docs/docs/reference/executionModes"><link data-react-helmet="true" rel="shortcut icon" href="/sdl-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pgruetter.github.io/sdl-docs/docs/reference/executionModes"><link rel="stylesheet" href="/sdl-docs/styles.1bc85f62.css">
<link rel="preload" href="/sdl-docs/styles.c300f951.js" as="script">
<link rel="preload" href="/sdl-docs/runtime~main.ca006c6a.js" as="script">
<link rel="preload" href="/sdl-docs/main.92f5c1b6.js" as="script">
<link rel="preload" href="/sdl-docs/1.668f9539.js" as="script">
<link rel="preload" href="/sdl-docs/57.263c3f40.js" as="script">
<link rel="preload" href="/sdl-docs/58.07ce31ae.js" as="script">
<link rel="preload" href="/sdl-docs/935f2afb.8befa69f.js" as="script">
<link rel="preload" href="/sdl-docs/56.bcdc5d90.js" as="script">
<link rel="preload" href="/sdl-docs/8853fb9a.899997b9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sdl-docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/sdl-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/sdl-docs/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/sdl-docs/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Execution Modes</h1></header><div class="markdown"><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This page is under review and currently not visible in the menu.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="execution-modes"></a>Execution modes<a aria-hidden="true" class="hash-link" href="#execution-modes" title="Direct link to heading">#</a></h2><p>Execution modes select the data to be processed. By default, if you start SmartDataLakeBuilder, there is no filter applied. This means every Action reads all data from its input DataObjects.</p><p>You can set an execution mode by defining attribute &quot;executionMode&quot; of an Action. Define the chosen ExecutionMode by setting type as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">executionMode {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = PartitionDiffMode</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  attribute1 = ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fixed-partition-values-filter"></a>Fixed partition values filter<a aria-hidden="true" class="hash-link" href="#fixed-partition-values-filter" title="Direct link to heading">#</a></h3><p>You can apply a filter manually by specifying parameter <code>--partition-values</code> or <code>--multi-partition-values</code> on the command line. The partition values specified are passed to all start-Actions of a DAG and filtered for every input DataObject by its defined partition columns.
On execution every Action takes the partition values of the input and filters them again for every output DataObject by its defined partition columns, which serve again as partition values for the input of the next Action.
Note that during execution of the dag, no new partition values are added, they are only filtered. An exception is if you place a PartitionDiffMode in the middle of your pipeline, see next section.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="partitiondiffmode-dynamic-partition-values-filter"></a>PartitionDiffMode: Dynamic partition values filter<a aria-hidden="true" class="hash-link" href="#partitiondiffmode-dynamic-partition-values-filter" title="Direct link to heading">#</a></h3><p>Alternatively you can let SmartDataLakeBuilder find missing partitions and set partition values automatically by specifying execution mode PartitionDiffMode.</p><p>By defining the <strong>applyCondition</strong> attribute you can give a condition to decide at runtime if the PartitionDiffMode should be applied or not.
Default is to apply the PartitionDiffMode if the given partition values are empty (partition values from command line or passed from previous action).
Define an applyCondition by a spark sql expression working with attributes of DefaultExecutionModeExpressionData returning a boolean.</p><p>By defining the <strong>failCondition</strong> attribute you can give a condition to fail application of execution mode if true.
It can be used to fail a run based on expected partitions, time and so on.
The expression is evaluated after execution of PartitionDiffMode, amongst others there are attributes inputPartitionValues, outputPartitionValues and selectedPartitionValues to make the decision.
Default is that the application of the PartitionDiffMode does not fail the action. If there is no data to process, the following actions are skipped.
Define a failCondition by a spark sql expression working with attributes of PartitionDiffModeExpressionData returning a boolean.</p><p>Example - fail if partitions are not processed in strictly increasing order of partition column &quot;dt&quot;:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  failCondition = &quot;(size(selectedPartitionValues) &gt; 0 and array_min(transform(selectedPartitionValues, x -&amp;gt x.dt)) &amp;lt array_max(transform(outputPartitionValues, x &gt; x.dt)))&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Sometimes the failCondition can become quite complex with multiple terms concatenated by or-logic.
To improve interpretabily of error messages, multiple fail conditions can be configured as array with attribute <strong>failConditions</strong>. For every condition you can also define a description which will be inserted into the error message.</p><p>Finally By defining <strong>selectExpression</strong> you can customize which partitions are selected.
Define a spark sql expression working with attributes of PartitionDiffModeExpressionData returning a Seq(Map(String,String)).</p><p>Example - only process the last selected partition:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  selectExpression = &quot;slice(selectedPartitionValues,-1,1)&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>By defining <strong>alternativeOutputId</strong> attribute you can define another DataObject which will be used to check for already existing data.
This can be used to select data to process against a DataObject later in the pipeline.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sparkstreamingmode-incremental-load"></a>SparkStreamingMode: Incremental load<a aria-hidden="true" class="hash-link" href="#sparkstreamingmode-incremental-load" title="Direct link to heading">#</a></h3><p>Some DataObjects are not partitioned, but nevertheless you dont want to read all data from the input on every run. You want to load it incrementally.
This can be accomplished by specifying execution mode SparkStreamingMode. Under the hood it uses &quot;Spark Structured Streaming&quot;.
In streaming mode this an Action with SparkStreamingMode is an asynchronous action. Its rhythm can be configured by setting triggerType and triggerTime.
If not in streaming mode SparkStreamingMode triggers a single microbatch by using triggerType=Once and is fully synchronized. Synchronous execution can be forced for streaming mode as well by explicitly setting triggerType=Once.
&quot;Spark Structured Streaming&quot; is keeping state information about processed data. It needs a checkpointLocation configured which can be given as parameter to SparkStreamingMode.</p><p>Note that &quot;Spark Structured Streaming&quot; needs an input DataObject supporting the creation of streaming DataFrames.
For the time being, only the input sources delivered with Spark Streaming are supported.
This are KafkaTopicDataObject and all SparkFileDataObjects, see also <a href="https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#creating-streaming-dataframes-and-streaming-datasets" target="_blank" rel="noopener noreferrer">Spark StructuredStreaming</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sparkincrementalmode-incremental-load"></a>SparkIncrementalMode: Incremental Load<a aria-hidden="true" class="hash-link" href="#sparkincrementalmode-incremental-load" title="Direct link to heading">#</a></h3><p>As not every input DataObject supports the creation of streaming DataFrames, there is an other execution mode called SparkIncrementalMode.
You configure it by defining the attribute <strong>compareCol</strong> with a column name present in input and output DataObject.
SparkIncrementalMode then compares the maximum values between input and output and creates a filter condition.
On execution the filter condition is applied to the input DataObject to load the missing increment.
Note that compareCol needs to have a sortable datatype.</p><p>By defining <strong>applyCondition</strong> attribute you can give a condition to decide at runtime if the SparkIncrementalMode should be applied or not.
Default is to apply the SparkIncrementalMode. Define an applyCondition by a spark sql expression working with attributes of DefaultExecutionModeExpressionData returning a boolean.</p><p>By defining <strong>alternativeOutputId</strong> attribute you can define another DataObject which will be used to check for already existing data.
This can be used to select data to process against a DataObject later in the pipeline.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="failifnopartitionvaluesmode"></a>FailIfNoPartitionValuesMode<a aria-hidden="true" class="hash-link" href="#failifnopartitionvaluesmode" title="Direct link to heading">#</a></h3><p>To simply check if partition values are present and fail otherwise, configure execution mode FailIfNoPartitionValuesMode.
This is useful to prevent potential reprocessing of whole table through wrong usage.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="processallmode"></a>ProcessAllMode<a aria-hidden="true" class="hash-link" href="#processallmode" title="Direct link to heading">#</a></h3><p>An execution mode which forces processing all data from it&#x27;s inputs, removing partitionValues and filter conditions received from previous actions.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="custompartitionmode"></a>CustomPartitionMode<a aria-hidden="true" class="hash-link" href="#custompartitionmode" title="Direct link to heading">#</a></h3><p>An execution mode to create custom partition execution mode logic in scala.
Implement trait CustomPartitionModeLogic by defining a function which receives main input&amp;output DataObject and returns partition values to process as Seq[Map[String,String]]</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="execution-condition"></a>Execution Condition<a aria-hidden="true" class="hash-link" href="#execution-condition" title="Direct link to heading">#</a></h2><p>For every Action an executionCondition can be defined. The execution condition allows to define if an action is executed or skipped. The default behaviour is that an Action is skipped if at least one input SubFeed is skipped.
Define an executionCondition by a spark sql expression working with attributes of SubFeedsExpressionData returning a boolean.
The Action is skipped if the executionCondition is evaluated to false. In that case dependent actions get empty SubFeeds marked with isSkipped=true as input.</p><p>Example - skip Action only if input1 and input2 SubFeed are skipped:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  executionCondition = &quot;!inputSubFeeds.input1.isSkipped or !inputSubFeeds.input2.isSkipped&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Example - Always execute Action and use all existing data as input:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  executionCondition = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  executionMode = ProcessAllMode</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#execution-modes" class="table-of-contents__link">Execution modes</a><ul><li><a href="#fixed-partition-values-filter" class="table-of-contents__link">Fixed partition values filter</a></li><li><a href="#partitiondiffmode-dynamic-partition-values-filter" class="table-of-contents__link">PartitionDiffMode: Dynamic partition values filter</a></li><li><a href="#sparkstreamingmode-incremental-load" class="table-of-contents__link">SparkStreamingMode: Incremental load</a></li><li><a href="#sparkincrementalmode-incremental-load" class="table-of-contents__link">SparkIncrementalMode: Incremental Load</a></li><li><a href="#failifnopartitionvaluesmode" class="table-of-contents__link">FailIfNoPartitionValuesMode</a></li><li><a href="#processallmode" class="table-of-contents__link">ProcessAllMode</a></li><li><a href="#custompartitionmode" class="table-of-contents__link">CustomPartitionMode</a></li></ul></li><li><a href="#execution-condition" class="table-of-contents__link">Execution Condition</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sdl-docs/docs/">Getting started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sdl-docs/blog">Blog</a></li><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELCA</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
<script src="/sdl-docs/styles.c300f951.js"></script>
<script src="/sdl-docs/runtime~main.ca006c6a.js"></script>
<script src="/sdl-docs/main.92f5c1b6.js"></script>
<script src="/sdl-docs/1.668f9539.js"></script>
<script src="/sdl-docs/57.263c3f40.js"></script>
<script src="/sdl-docs/58.07ce31ae.js"></script>
<script src="/sdl-docs/935f2afb.8befa69f.js"></script>
<script src="/sdl-docs/56.bcdc5d90.js"></script>
<script src="/sdl-docs/8853fb9a.899997b9.js"></script>
</body>
</html>