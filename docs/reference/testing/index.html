<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<title data-react-helmet="true">Testing | Smart Data Lake Builder</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Testing | Smart Data Lake Builder"><meta data-react-helmet="true" name="description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:url" content="https://pgruetter.github.io/sdl-docs/docs/reference/testing"><link data-react-helmet="true" rel="shortcut icon" href="/sdl-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pgruetter.github.io/sdl-docs/docs/reference/testing"><link rel="stylesheet" href="/sdl-docs/styles.1bc85f62.css">
<link rel="preload" href="/sdl-docs/styles.c300f951.js" as="script">
<link rel="preload" href="/sdl-docs/runtime~main.ca006c6a.js" as="script">
<link rel="preload" href="/sdl-docs/main.1cfb2226.js" as="script">
<link rel="preload" href="/sdl-docs/1.668f9539.js" as="script">
<link rel="preload" href="/sdl-docs/57.263c3f40.js" as="script">
<link rel="preload" href="/sdl-docs/58.07ce31ae.js" as="script">
<link rel="preload" href="/sdl-docs/935f2afb.8befa69f.js" as="script">
<link rel="preload" href="/sdl-docs/56.bcdc5d90.js" as="script">
<link rel="preload" href="/sdl-docs/9defd34c.952c6fc7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sdl-docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/sdl-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/sdl-docs/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/sdl-docs/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Testing</h1></header><div class="markdown"><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This page is under review and currently not visible in the menu.</p></div></div><p>Testing is crucial for software quality and maintenance. This is also true for data pipelines.</p><p>SDL provides the following possibilities for Testing:</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="config-validation"></a>Config validation<a aria-hidden="true" class="hash-link" href="#config-validation" title="Direct link to heading">#</a></h2><p>Parsing of configuration can be validated by specifying command line parameter <code>--test config</code> or programmatically:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ConfigTest extends FunSuite with TestUtil {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  test(&quot;validate configuration&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val (registry, globalConfig) = ConfigToolbox.loadAndParseConfig(Seq(&quot;src/main/resources&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert(registry.getActions.nonEmpty)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>This should be done in continuous integration.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dry-run"></a>Dry run<a aria-hidden="true" class="hash-link" href="#dry-run" title="Direct link to heading">#</a></h2><p>A dry-run can be started by specifying command line parameter <code>--test dry-run</code>.
The dry-run executes only prepare and init phase. It validates configuration, checks connections and validates Spark lineage.
It doesn&#x27;t change anything in the environment.</p><p>This is suitable for smoke testing after deployment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="custom-transformation-logic-unit-tests"></a>Custom transformation logic unit tests<a aria-hidden="true" class="hash-link" href="#custom-transformation-logic-unit-tests" title="Direct link to heading">#</a></h2><p>Logic of custom transformation can easily be unit tested. Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyCustomTransformerTest extends FunSuite {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // init spark session</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val sparkSession = Map(&quot;spark.default.parallelism&quot; -&gt; &quot;1&quot;, &quot;spark.sql.shuffle.partitions&quot; -&gt; &quot;1&quot;, &quot;spark.task.maxFailures&quot; -&gt; &quot;1&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lazy val session: SparkSession = GlobalConfig(enableHive = false, sparkOptions = Some(sparkSession))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .createSparkSession(&quot;test&quot;, Some(&quot;local[*]&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  import session.implicits._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  test(&quot;test my custom transformer&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // define input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val dfInput = Seq((&quot;joe&quot;,1)).toDF(&quot;name&quot;, &quot;cnt&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // transform</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val transformer = new MyCustomTransformer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val dfsInput = Map(&quot;input&quot; -&gt; dfInput)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val dfsTransformed = transformer.transform(session, Map(), dfsInput)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val dfOutput = dfsTransformed(&quot;output&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // check</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert(dfOutput.count == 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="simulation-of-spark-data-pipeline"></a>Simulation of spark data pipeline<a aria-hidden="true" class="hash-link" href="#simulation-of-spark-data-pipeline" title="Direct link to heading">#</a></h2><p>Instead of testing single transformation logic, it would be interesting to test whole pipelines of spark actions.
For this you can start a simulation run programmatically. You have to provide all input data frames and get the output data frames of the end nodes of the DAG.
The simulation mode only executes the init phase with special modification, so it runs without any environment. Of course there are some exceptions like kafka/confluent schema registry.
Note that simulation mode only supports spark actions for now, you might need to choose &quot;feedSel&quot; accordingly.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyDataPipelineTest extends FunSuite with TestUtil {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // load config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val (registry, globalConfig) = ConfigToolbox.loadAndParseConfig(Seq(&quot;src/main/resources&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // init spark session</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val sparkSession = Map(&quot;spark.default.parallelism&quot; -&gt; &quot;1&quot;, &quot;spark.sql.shuffle.partitions&quot; -&gt; &quot;1&quot;, &quot;spark.task.maxFailures&quot; -&gt; &quot;1&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lazy val session: SparkSession = GlobalConfig(enableHive = false, sparkOptions = Some(sparkSession))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .createSparkSession(&quot;test&quot;, Some(&quot;local[*]&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  import session.implicits._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  test(&quot;enrich and process: create alarm&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // get input1 from modified data object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val input1DO = registry.get[CsvFileDataObject](&quot;input1&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .copy(connectionId = None, path = &quot;src/test/resources/sample_input1.csv&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val dfInput1 = input1DO.getDataFrame()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // define input2 manually</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val dfInput2 = Seq((&quot;joe&quot;,1)).toDF(&quot;name&quot;, &quot;cnt&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // transform</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val inputSubFeeds = Seq(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SparkSubFeed(Some(dfInput1), DataObjectId(&quot;input1&quot;), Seq()),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SparkSubFeed(Some(dfInput2), DataObjectId(&quot;ipnut2&quot;), Seq())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val config = SmartDataLakeBuilderConfig(feedSel = s&quot;my-feed&quot;, applicationName = Some(&quot;test&quot;), configuration = Some(&quot;test&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val sdlb = new DefaultSmartDataLakeBuilder()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val (finalSubFeeds, stats) = sdlb.startSimulation(config, inputSubFeeds)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val dfOutput = finalSubFeeds.find(_.dataObjectId.id == s&quot;output&quot;).get.dataFrame.get.cache</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // check</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val output = dfOutput.select($&quot;name&quot;, $&quot;test&quot;).as[(String,Boolean)].collect.toSeq</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert(output == Seq((&quot;joe&quot;, true)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#config-validation" class="table-of-contents__link">Config validation</a></li><li><a href="#dry-run" class="table-of-contents__link">Dry run</a></li><li><a href="#custom-transformation-logic-unit-tests" class="table-of-contents__link">Custom transformation logic unit tests</a></li><li><a href="#simulation-of-spark-data-pipeline" class="table-of-contents__link">Simulation of spark data pipeline</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sdl-docs/docs/">Getting started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sdl-docs/blog">Blog</a></li><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELCA</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
<script src="/sdl-docs/styles.c300f951.js"></script>
<script src="/sdl-docs/runtime~main.ca006c6a.js"></script>
<script src="/sdl-docs/main.1cfb2226.js"></script>
<script src="/sdl-docs/1.668f9539.js"></script>
<script src="/sdl-docs/57.263c3f40.js"></script>
<script src="/sdl-docs/58.07ce31ae.js"></script>
<script src="/sdl-docs/935f2afb.8befa69f.js"></script>
<script src="/sdl-docs/56.bcdc5d90.js"></script>
<script src="/sdl-docs/9defd34c.952c6fc7.js"></script>
</body>
</html>