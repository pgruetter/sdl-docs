<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<title data-react-helmet="true">Deploy on Microsoft Azure Databricks | Smart Data Lake Builder</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Deploy on Microsoft Azure Databricks | Smart Data Lake Builder"><meta data-react-helmet="true" name="description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:url" content="https://pgruetter.github.io/sdl-docs/docs/reference/deploy-microsoft-azure"><link data-react-helmet="true" rel="shortcut icon" href="/sdl-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pgruetter.github.io/sdl-docs/docs/reference/deploy-microsoft-azure"><link rel="stylesheet" href="/sdl-docs/styles.544fbe57.css">
<link rel="preload" href="/sdl-docs/styles.9f6a0338.js" as="script">
<link rel="preload" href="/sdl-docs/runtime~main.0039e60e.js" as="script">
<link rel="preload" href="/sdl-docs/main.e121cc6e.js" as="script">
<link rel="preload" href="/sdl-docs/1.f3494e66.js" as="script">
<link rel="preload" href="/sdl-docs/46.e6127c66.js" as="script">
<link rel="preload" href="/sdl-docs/47.2f88f8f5.js" as="script">
<link rel="preload" href="/sdl-docs/935f2afb.23e4ea58.js" as="script">
<link rel="preload" href="/sdl-docs/45.ee66667a.js" as="script">
<link rel="preload" href="/sdl-docs/21a79bec.9743cde6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sdl-docs/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/sdl-docs/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Deploy on Microsoft Azure Databricks</h1></header><div class="markdown"><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This page is under review and currently not visible in the menu.</p></div></div><p>Smart Data Lake can be executed on the Databricks Service running on Microsoft Azure.
The following steps show how to execute a simple copy feed.</p><p>At the time of this writing, a few extra steps are needed to overwrite specific libraries.
When running a job in Databricks, a few dependencies are given and can not be simply overwritten with your own as described in the
<a href="https://docs.microsoft.com/en-us/azure/databricks/jobs#library-dependencies" target="_blank" rel="noopener noreferrer">Azure documentation</a>.
Since we use a newer version of typesafe config, we need to force the overwrite of this dependency.
We will create a cluster init script that downloads the library and saves it on the cluster, then use Sparks ChildFirstURLClassLoader to explicitly load our library first.
This can hopefully be simplified in the future.</p><ol><li><p>In your Azure portal, create a Databricks Workspace and launch it</p></li><li><p>Create a cluster that fits your needs. For a first test you can use the miminal configuration of 1 Worker and 1 Driver node.
This example was tested on Databricks Runtime Version 6.2.</p></li><li><p>Open the Advanced Options, Init Scripts and configure the path:
dbfs:/databricks/scripts/config-install.sh</p></li><li><p>On your local machine, create a simple script called config-install.sh with the following content</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> -O /databricks/jars/config-1.3.4.jar https://repo1.maven.org/maven2/com/typesafe/config/1.3.4/config-1.3.4.jar</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></li><li><p>To copy this local file to your Databricks filesystem, use the <a href="https://docs.databricks.com/dev-tools/cli/index.html" target="_blank" rel="noopener noreferrer">Databricks CLI</a>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">databricks fs mkdirs dbfs:/databricks/scripts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">databricks fs </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">ltpath-to/config-install.sh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">gt dbfs:/databricks/scripts/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Now this script gets executed everytime the cluster starts.
It will download the config library and put it in a place where the classloader can find it.</p></li><li><p>Start your cluster, check the event log to see if it&#x27;s up.
If something is wrong with the init script, the cluster will not start.</p></li><li><p>On your local machine, create a second file called application.conf with the following content:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-hocon codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dataObjects {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ab-csv-dbfs {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = CsvFileDataObject</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    path = &quot;file:///dbfs/data/AB_NYC_2019.csv&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ab-reduced-csv-dbfs {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = CsvFileDataObject</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    path = &quot;file:///dbfs/data/~{id}/nyc_reduced.csv&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">actions {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  loadDbfs2Dbfs {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = CopyAction</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    inputId = ab-csv-dbfs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    outputId = ab-reduced-csv-dbfs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      feed = ab-azure</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></li><li><p>Upload the file to the conf folder in dbfs:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">databricks fs mkdirs dbfs:/conf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">databricks fs </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> path-to/application.conf dbfs:/conf/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></li><li><p>Also copy the example CSV file from sdl-examples to the data folder:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">databricks fs mkdirs dbfs:/data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">databricks fs </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">path-to/AB_NYC_2019.csv</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> dbfs:/data/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></li><li><p>Now create a Job with the following details:</p><p> Task: Upload JAR - Choose the smartdatalake-&lt;version&gt;-jar-with-dependencies.jar</p><p> Main Class: io.smartdatalake.app.DatabricksSmartDataLakeBuilder
Arguments: -c file:///dbfs/conf/ --feed-sel ab-azure -m yarn</p><p> The option <em>--override-jars</em> is set automatically to the correct value for DatabricksConfigurableApp.
If you want to override any additional libraries, you can provide a list with this option.</p><p> If you don&#x27;t have the JAR file yet, check the README on how to build it (using the Maven profile fat-jar).</p></li><li><p>Start the job and check the result, you should now have the output written in dbfs:/data/ab-reduced-csv-dbfs</p></li></ol></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sdl-docs/docs/">Getting started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELCA</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
<script src="/sdl-docs/styles.9f6a0338.js"></script>
<script src="/sdl-docs/runtime~main.0039e60e.js"></script>
<script src="/sdl-docs/main.e121cc6e.js"></script>
<script src="/sdl-docs/1.f3494e66.js"></script>
<script src="/sdl-docs/46.e6127c66.js"></script>
<script src="/sdl-docs/47.2f88f8f5.js"></script>
<script src="/sdl-docs/935f2afb.23e4ea58.js"></script>
<script src="/sdl-docs/45.ee66667a.js"></script>
<script src="/sdl-docs/21a79bec.9743cde6.js"></script>
</body>
</html>