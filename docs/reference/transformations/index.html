<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<title data-react-helmet="true">Transformations | Smart Data Lake Builder</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Transformations | Smart Data Lake Builder"><meta data-react-helmet="true" name="description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:url" content="https://pgruetter.github.io/sdl-docs/docs/reference/transformations"><link data-react-helmet="true" rel="shortcut icon" href="/sdl-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pgruetter.github.io/sdl-docs/docs/reference/transformations"><link rel="stylesheet" href="/sdl-docs/styles.1bc85f62.css">
<link rel="preload" href="/sdl-docs/styles.c300f951.js" as="script">
<link rel="preload" href="/sdl-docs/runtime~main.ca006c6a.js" as="script">
<link rel="preload" href="/sdl-docs/main.92f5c1b6.js" as="script">
<link rel="preload" href="/sdl-docs/1.668f9539.js" as="script">
<link rel="preload" href="/sdl-docs/57.263c3f40.js" as="script">
<link rel="preload" href="/sdl-docs/58.07ce31ae.js" as="script">
<link rel="preload" href="/sdl-docs/935f2afb.8befa69f.js" as="script">
<link rel="preload" href="/sdl-docs/56.bcdc5d90.js" as="script">
<link rel="preload" href="/sdl-docs/5043d23c.603d7156.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sdl-docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/sdl-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/sdl-docs/"><img src="/sdl-docs/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Smart Data Lake Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Smart Data Lake</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/sdl-docs/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/sdl-docs/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Transformations</h1></header><div class="markdown"><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This page is under review and currently not visible in the menu.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="spark-transformations"></a>Spark Transformations<a aria-hidden="true" class="hash-link" href="#spark-transformations" title="Direct link to heading">#</a></h2><p>To implement custom transformation logic, define the <strong>transformers</strong> attribute of an Action. It allows you to chain several transformation in a linear process,
where output SubFeeds from one transformation are use as input for the next.<br>
Note that the definition of the transformations looks different for:</p><ul><li><strong>1-to-1</strong> transformations (*DfTransformer): One input DataFrame is transformed into one output DataFrame. This is the case for CopyAction, DeduplicateAction and HistorizeAction.</li><li><strong>many-to-many</strong> transformations (*DfsTransformer): Many input DataFrames can be transformed into many output DataFrames. This is the case for CustomSparkAction.</li></ul><p>The configuration allows you to use predefined standard transformations or to define custom transformation in various languages.</p><p><strong>Deprecation Warning</strong>: there has been a refactoring of transformations in Version 2.0.5. The attribute <strong>transformer</strong> is deprecated and will be removed in future versions. Use <strong>transformers</strong> instead.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="predefined-transformations"></a>Predefined Transformations<a aria-hidden="true" class="hash-link" href="#predefined-transformations" title="Direct link to heading">#</a></h3><p>Predefined transformations implement generic logic to be reused in different actions. The following Transformers exist:</p><ul><li>FilterTransformer (1-to-1): Filter DataFrame with expression</li><li>BlacklistTransformer (1-to-1): Apply a column blacklist to a DataFrame</li><li>WhitelistTransformer (1-to-1): Apply a column whitelist to a DataFrame</li><li>AdditionalColumnsTransformer (1-to-1): Add additional columns to the DataFrame by extracting information from the context</li><li>StandardizeDatatypesTransformer (1-to-1): Standardize datatypes of a DataFrame</li><li>DfTransformerWrapperDfsTransformer (many-to-many): use 1-to-1 transformer as many-to-many transformer by specifying the SubFeeds it should be applied to</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="custom-transformations"></a>Custom Transformations<a aria-hidden="true" class="hash-link" href="#custom-transformations" title="Direct link to heading">#</a></h3><p>Custom transformers provide an easy way to define your own spark logic in various languages.</p><p>You can pass static <strong>options</strong> and <strong>runtimeOptions</strong> to custom transformations. runtimeOptions are extracted at runtime from the context.
Specifying options allows to reuse a transformation in different settings.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="javascala"></a>Java/Scala<a aria-hidden="true" class="hash-link" href="#javascala" title="Direct link to heading">#</a></h4><p>You can use Spark Dataset API in Java/Scala to define custom transformations.
If you have a Java project, create a class that extends CustomDfTransformer or CustomDfsTransformer and implement <code>transform</code> method.
Then use <strong>type = ScalaClassDfTransformer</strong> or <strong>type = ScalaClassDfsTransformer</strong> and configure <strong>className</strong> attribute.</p><p>If you work without Java project, it&#x27;s still possible to define your transformation in Java/Scala and compile it at runtime.
For a 1-to-1 transformation use <strong>type = ScalaCodeDfTransformer</strong> and configure <strong>code</strong> or <strong>file</strong> as a function that takes <code>session: SparkSession, options: Map[String,String], df: DataFrame, dataObjectName: String</code> as parameters and returns a <code>DataFrame</code>.
For many-to-many transformations use <strong>type = ScalaCodeDfsTransformer</strong> and configure <strong>code</strong> or <strong>file</strong> as a function that takes <code>session: SparkSession, options: Map[String,String], dfs: Map[String,DataFrame]</code> with DataFrames per input DataObject as parameter, and returns a <code>Map[String,DataFrame]</code> with the DataFrame per output DataObject.</p><p>See <a href="https://github.com/smart-data-lake/sdl-examples" target="_blank" rel="noopener noreferrer">sdl-examples</a> for details.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sql"></a>SQL<a aria-hidden="true" class="hash-link" href="#sql" title="Direct link to heading">#</a></h4><p>You can use Spark SQL to define custom transformations.
Input dataObjects are available as tables to select from. Use tokens %{&lt;key&gt;} to replace with runtimeOptions in SQL code.
For a 1-to-1 transformation use <strong>type = SQLDfTransformer</strong> and configure <strong>code</strong> as your SQL transformation statement.
For many-to-many transformations use <strong>type = SQLDfsTransformer</strong> and configure <strong>code</strong> as a Map of &quot;&lt;outputDataObjectId&gt;, &lt;SQL transformation statement&gt;&quot;.</p><p>Example - using options in sql code for 1-to-1 transformation:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">transformers = [{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = SQLDfTransformer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name = &quot;test run&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;description of test run...&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlCode = &quot;select id, cnt, &#x27;%{test}&#x27; as test, %{run_id} as last_run_id from dataObject1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    test = &quot;test run&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  runtimeOptions = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    last_run_id = &quot;runId - 1&quot; // runtime options are evaluated as spark SQL expressions against DefaultExpressionData</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Example - defining a many-to-many transformation:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">transformers = [{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = SQLDfsTransformer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  code = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dataObjectOut1 = &quot;select id,cnt from dataObjectIn1 where group = &#x27;test1&#x27;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dataObjectOut2 = &quot;select id,cnt from dataObjectIn1 where group = &#x27;test2&#x27;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>See <a href="https://github.com/smart-data-lake/sdl-examples" target="_blank" rel="noopener noreferrer">sdl-examples</a> for details.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="python"></a>Python<a aria-hidden="true" class="hash-link" href="#python" title="Direct link to heading">#</a></h4><p>It&#x27;s also possible to use Python to define a custom Spark transformation.
For a 1-to-1 transformation use <strong>type = PythonCodeDfTransformer</strong> and configure <strong>code</strong> or <strong>file</strong> as a python function.
PySpark session is initialize and available under variables <code>sc</code>, <code>session</code>, <code>sqlContext</code>.
Other variables available are</p><ul><li><code>inputDf</code>: Input DataFrame</li><li><code>options</code>: Transformation options as Map[String,String]</li><li><code>dataObjectId</code>: Id of input dataObject as String</li></ul><p>Output DataFrame must be set with <code>setOutputDf(df)</code>.</p><p>For now using Python for many-to-many transformations is not possible, although it would be not so hard to implement.</p><p>Example - apply some python calculation as udf:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">transformers = [{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = PythonCodeDfTransformer </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  code = &quot;&quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |from pyspark.sql.functions import *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |udf_multiply = udf(lambda x, y: x * y, &quot;int&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |dfResult = inputDf.select(col(&quot;name&quot;), col(&quot;cnt&quot;))\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |  .withColumn(&quot;test&quot;, udf_multiply(col(&quot;cnt&quot;).cast(&quot;int&quot;), lit(2)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |setOutputDf(dfResult)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;&quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Requirements:</p><ul><li>Spark 2.4.x:<ul><li>Python version &gt;= 3.4 an &lt;= 3.7</li><li>PySpark package matching your spark version</li></ul></li><li>Spark 3.x:<ul><li>Python version &gt;= 3.4</li><li>PySpark package matching your spark version</li></ul></li></ul><p>See Readme of <a href="https://github.com/smart-data-lake/sdl-examples" target="_blank" rel="noopener noreferrer">sdl-examples</a> for a working example and instructions to setup python environment for IntelliJ</p><p>How it works: under the hood a PySpark DataFrame is a proxy for a Java Spark DataFrame. PySpark uses Py4j to access Java objects in the JVM.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#spark-transformations" class="table-of-contents__link">Spark Transformations</a><ul><li><a href="#predefined-transformations" class="table-of-contents__link">Predefined Transformations</a></li><li><a href="#custom-transformations" class="table-of-contents__link">Custom Transformations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sdl-docs/docs/">Getting started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sdl-docs/blog">Blog</a></li><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELCA</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
<script src="/sdl-docs/styles.c300f951.js"></script>
<script src="/sdl-docs/runtime~main.ca006c6a.js"></script>
<script src="/sdl-docs/main.92f5c1b6.js"></script>
<script src="/sdl-docs/1.668f9539.js"></script>
<script src="/sdl-docs/57.263c3f40.js"></script>
<script src="/sdl-docs/58.07ce31ae.js"></script>
<script src="/sdl-docs/935f2afb.8befa69f.js"></script>
<script src="/sdl-docs/56.bcdc5d90.js"></script>
<script src="/sdl-docs/5043d23c.603d7156.js"></script>
</body>
</html>